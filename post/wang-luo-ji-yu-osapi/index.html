<html>
  <head>
    <meta charset="utf-8" />
<meta name="description" content="" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>网络—基于OSAPI | dr526</title>
<link rel="shortcut icon" href="https://dr526.github.io//favicon.ico?v=1602046645180">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://dr526.github.io//styles/main.css">

<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script src="https://cdn.bootcss.com/moment.js/2.23.0/moment.min.js"></script>



  </head>
  <body>
    <div class="main">
      <div class="main-content">
        <div class="site-header">
  <a href="https://dr526.github.io/">
  <img class="avatar" src="https://dr526.github.io//images/avatar.png?v=1602046645180" alt="">
  </a>
  <h1 class="site-title">
    dr526
  </h1>
  <p class="site-description">
    十步one code，千里no bug
  </p>
  <div class="menu-container">
    
      
        <a href="/" class="menu">
          首页
        </a>
      
    
      
        <a href="/archives" class="menu">
          归档
        </a>
      
    
      
        <a href="/tags" class="menu">
          标签
        </a>
      
    
      
        <a href="/post/about" class="menu">
          关于
        </a>
      
    
  </div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
  </div>
</div>


        <div class="post-detail">
          <article class="post">
            <h2 class="post-title">
              网络—基于OSAPI
            </h2>
            <div class="post-info">
              <time class="post-time">
                · 2020-09-22 ·
              </time>
              
            </div>
            
            <div class="post-content">
              <h1 id="网络通讯和ip地址">网络通讯和IP地址</h1>
<ul>
<li>
<p>两台主机通过网络来传输数据，称为网络通讯</p>
</li>
<li>
<p>一些术语</p>
<ol>
<li>主机：<strong>Host</strong>，包含台式机、笔记本、手机等设备</li>
<li>网络：<strong>Internet</strong></li>
<li>网络介质：<strong>Media</strong>，网线，光纤，无线局域网wifi，移动3G网络</li>
<li>数据：<strong>Data</strong>，一串字节</li>
</ol>
</li>
<li>
<p>网络通讯的观测</p>
<ol>
<li>安装<strong>Wireshark</strong>，即可对网络通讯进行观测</li>
<li>抓：<strong>capture</strong></li>
<li>包：<strong>packet</strong>，数据包</li>
</ol>
</li>
<li>
<p>IP地址：<strong>Internet Protocol Address</strong></p>
<ol>
<li>用于标识网络上的一台主机，IP地址用<strong>4字节</strong>表示，称为<strong>IPv4</strong></li>
<li>用字符串表示时，10进制，以点号分开**(0-255)**<br>
“192.168.1.1”</li>
<li>用16进制表示<br>
C0 A8 01 01(192.168.1.1)</li>
</ol>
</li>
<li>
<p><strong>ping</strong>命令：检测连通</p>
<ol>
<li>
<p>不连通的三种可能性</p>
<p>（1） 对方关机、离线<br>
（2） 己方没有连网<br>
（3） 对方在线，但对方屏蔽了PING服务</p>
</li>
</ol>
</li>
<li>
<p>查看自己的IP地址</p>
<ol>
<li>windows上，输入<strong>ipconfig</strong></li>
<li>linux下，输入<strong>ifconfig</strong></li>
</ol>
</li>
</ul>
<h1 id="socket与复用技术">Socket与复用技术</h1>
<ul>
<li>
<p>Socket概念</p>
<p>两台主机进行通讯，运行不同的程序，它们都在使用网络进行数据传输，如何区分？</p>
<p>Socket原意时“插座”，它形象的表示：用一根线连接两个插座，即形成一个数据通道</p>
<p>每个插口用一个数字标识**（0-65535）<strong>，这个数字就称为端口</strong>（port)**</p>
</li>
<li>
<p>复用技术</p>
<ol>
<li>
<p>待解决问题：</p>
<p>多个Socket，每个Socket上同时传输着不同的数据（视频流、文件流等），但是，网线只有一根，字节是<strong>串行</strong>传输的（一个字节一个字节地发送）</p>
</li>
<li>
<p>解决办法：</p>
<p><strong>封包</strong>：将（IP，Port)放在包头，<strong>交替</strong>发送包</p>
<p>这种在一个信道内，交叉间隔地传输数据的方案，称为**“分时复用”**</p>
<p>发送方：复用Mux，将每个Socket上的数据，<strong>拆分成固定格式的小包</strong>，每个小包前面加上IP/Port，按照时间间隔，轮番发送到信道中</p>
<p>接收方：解复用Demux，从信道中接收到小包，根据包头的Port，将小包<strong>还原</strong>成原始数据，再<strong>分发</strong>给不同的Socket处理</p>
<p>分包目的：<strong>各Socket均匀占用网络</strong></p>
</li>
</ol>
</li>
</ul>
<h1 id="udp基本用法">UDP基本用法</h1>
<ul>
<li>
<p>Socket的种类</p>
<ol>
<li>UDP</li>
<li>TCP</li>
</ol>
</li>
<li>
<p>UDP Socket</p>
<ol>
<li>
<p>UDP（User Datagram Protocol），用户数据报文协议，<strong>适用于局域网的主机间的通信</strong></p>
</li>
<li>
<p>UDP的单机测试</p>
<p><strong>发送方</strong></p>
<pre><code class="language-c++">#include&lt;iostream&gt;
#include&quot;osapi/osapi.h&quot;

int main() {
	std::cout &lt;&lt; &quot;发送方：port=9000\n&quot;;
    //创建Socket
	OS_SockAddr local(&quot;192.168.51.65&quot;, 9000);
	OS_UdpSocket sock;
	sock.Open(local, true);

	while (1) {
		//让用户输入一段文本
		char buf[128];
		std::cout &lt;&lt; &quot;&gt;&quot;;
		gets_s(buf);
		int n = strlen(buf);

		//发送
		OS_SockAddr peer(&quot;192.168.51.65&quot;, 9001);//对方地址
		sock.SendTo(buf, n, peer);

		//结束
		if (strcmp(&quot;bye&quot;, buf) == 0) {
			break;
		}
	}

	//关闭Socket
	sock.Close();
	return 0;
}
</code></pre>
<p><strong>接受方</strong></p>
<pre><code class="language-c++">#include&lt;iostream&gt;
#include&quot;osapi/osapi.h&quot;

int main() {
	std::cout &lt;&lt; &quot;接受方：port=9001\n&quot;;
    //创建Socket
	OS_SockAddr local(&quot;192.168.51.65&quot;, 9001);
	OS_UdpSocket sock;
	sock.Open(local, true);

	while (1) {
        //接受
		char buf[128];
		OS_SockAddr peer;//对方的地址
		int n = sock.RecvFrom(buf, 128, peer);
		if (n &lt;= 0) {
			break;
		}
		buf[n] = 0;
		printf_s(&quot;Got：%s\n&quot;, buf);
		//结束
		if (strcmp(&quot;bye&quot;, buf) == 0) {
			break;
		}
	}
	//关闭socket
	sock.Close();
	return 0;
}
</code></pre>
</li>
<li>
<p>UDP多机测试</p>
<ul>
<li>
<p>使用虚拟机构造多机环境</p>
<p>本机环境：Microsoft Windows 10专业版 10.0.19041</p>
<p>虚拟机软件：Oracle VM VirtualBox-6.1.6</p>
<p>虚拟机系统：Ubuntu20.04</p>
<p>配置参照：</p>
<p>问题：通过<strong>ifconfig</strong>查看IP地址，若IP地址显示10.0.2.15</p>
</li>
</ul>
<figure data-type="image" tabindex="1"><img src="https://dr526.github.io//post-images/1600780305386.png" alt="" loading="lazy"></figure>
<p>解决：将网络的连接方式改为桥接网卡</p>
<figure data-type="image" tabindex="2"><img src="https://dr526.github.io//post-images/1600780283253.png" alt="" loading="lazy"></figure>
<p>借鉴了以下内容</p>
<p>​	<a href="https://blog.csdn.net/u014581901/article/details/77771505">VirtualBox安装Lunix系统ip地址的问题</a></p>
<p>​	 <a href="https://blog.csdn.net/Wenen_/article/details/105176500">VirtualBox安装ubuntu系统ip地址显示10.0.2.15</a></p>
<p>出现虚拟机Ping主机失败</p>
<figure data-type="image" tabindex="3"><img src="https://dr526.github.io//post-images/1600780295973.png" alt="" loading="lazy"></figure>
<p>解决方案：<a href="https://blog.csdn.net/qq_26822029/article/details/80428138">Ubuntu虚拟机无法ping通windows，反之可以的解决办法</a></p>
</li>
</ol>
</li>
</ul>

            </div>
          </article>
        </div>

        
          <div class="next-post">
            <div class="next">下一篇</div>
            <a href="https://dr526.github.io/post/dao-ru-di-san-fang-ku-osapi/">
              <h3 class="post-title">
                导入第三方库—OSAPI
              </h3>
            </a>
          </div>
        

        
          
            <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>

<div id="gitalk-container"></div>

<script>

  var gitalk = new Gitalk({
    clientID: '',
    clientSecret: '',
    repo: '',
    owner: '',
    admin: [''],
    id: (location.pathname).substring(0, 49),      // Ensure uniqueness and length less than 50
    distractionFreeMode: false  // Facebook-like distraction free mode
  })

  gitalk.render('gitalk-container')

</script>

          

          
        

        <div class="site-footer">
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | 
  <a class="rss" href="https://dr526.github.io//atom.xml" target="_blank">RSS</a>
</div>

<script>
  hljs.initHighlightingOnLoad()
</script>

      </div>
    </div>
  </body>
</html>
